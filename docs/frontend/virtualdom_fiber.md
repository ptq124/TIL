# 가상돔과 리액트 파이버

## 가상 DOM

가상돔은 브라우저 렌더링 시 요소 변경이 발생할 경우 메모리에 바뀐 정보들을 저장 후 리얼돔에 반영시키는 과정을 거친다.

가상돔은 메모리를 사용하여 브라우저 렌더링 시 변경에 대한 성능저하를 막아줌

브라우저 렌더링 시 트리 깊은 곳에서 하위 노드 변경이 발생할 경우, 전체적으로 재 렌더링이 발생한다. 이는 높은 비용의 증가로 효율성이 좋지 못하다. 특히 한 개의 페이지로 이뤄진 SPA 방식 경우, 재 렌더링 비용이 급격히 증가하게 된다. SPA 특징으로 이용자는 화면 깜빡임 없이 자연스러운 웹 페이지를 볼 수 있지만, DOM을 관리하는 과정은 부담스러울 것이다.

이러한 문제를 해결하기 위해 탄생된 것이 가상 DOM이다. 가상 DOM은 웹 페이지가 표시해야 할 DOM을 일단 메모리에 저장한 뒤, 실제 변경 준비가 완료 됐을때, 실제 브라우저인 리얼 DOM에 반영된다.

이렇게 DOM 계산을 실제 브라우저가 아닌 메모리에서 계산하는 과정을 통해 실제 여러번 일어 났어야 될 브라우저 렌더링 과정을 최소화 할 수 있다.

하지만, 가상 DOM 방식이 브라우저에서 관리하는 DOM보다 빠르다는 것은 아니다.

렌더링 방식에서 브라우저 개발에게 도움을 줄 수 있는 가상 DOM을 만들었고, 웹 개발을 할 만큼 합리적으로 빠르기 때문에 채택되었다.

## 리액트 파이버

궁금한 부분:

- 가상 DOM을 만드는 과정을 리액트가 어떻게 처리하고 있을까?
- 리액트는 여러번의 렌더링 과정을 압축해 어떻게 최소한의 렌더링을 만드는 것 일까?
- 가상 DOM 과 렌더링 과정을 최적화를 가능하게 해주는 것이 바로 리액트 파이버다.

### 리액트파이버?

- 리액트 파이버는 자바스크립트 객체다.
- 파이버는 파이버 재조정자가 관리한다.
- 가상 DOM 과 실제 DOM 을 비교해 차이가 있으면, 변경된 정보를 파이버 기준으로 화면에 렌더링을 요청한다.

### 파이버가 하는 일?

이 과정은 전부 비동기로 발생함

- 작업을 작은 단위로 분할하고 쪼갠 다음, 우선순위를 매긴다.
- 이러한 작업을 일시 중지하고, 나중에 다시 시작할 수 있다.
- 이전에 했던 작업을 다시 재사용 하거나 필요하지 않은 경우에는 폐기할 수 있다.

리액트 요소는 렌더링이 발생할 때마다 새롭게 생성되지만, 파이버는 가급적이면 재사용된다.

리액트 파이버의 가상 DOM은 단순한 자바스크립트 객체로 관리되고 있다.

```html
<ul>
  <li>하나</li>
  <li>둘</li>
  <li>셋</li>
</ul>
```

```jsx
const l3 = {
  return: ul,
  index: 2,
}
const l2 = {
  sibling: l3,
  return: ul,
  index: 1,
}
const l1 = {
  sibling: l2,
  return: ul,
  index: 0,
}
const ul = {
  // ...
  child: l1,
}
```

이처럼 리액트의 핵심 원칙은 UI를 문자열, 숫자, 배열과 같은 값으로 관리하는 점이다.

### 리액트 파이버 트리

리액트 파이버 트리 모습

![Untitled](https://velog.velcdn.com/images/jihyeonjeong11/post/7a9f6052-5e36-4828-872d-63fbb0da10d6/image.png)

위 사진을 설명하자면 더블 버퍼링 기법을 사용한다는 것이다.

더블 버퍼링은 컴퓨터 그래픽 분야 용어인데, 쉽게 말하면 부드러운 화면을 위해 미리 화면을 그린다음 현재 상태를 새로운 그림으로 바꾸는 것임

workInProgress에 변경이 일어나면, current 가 workInProgress로 바뀐다. 즉, 리액트 파이버 트리는 미처 다 그리지 못한 모습을 노출시키지 않기 위해 사용되는 것이다.

### 리액트 파이버 작업 순서

![Untitled](https://velog.velcdn.com/images/jihyeonjeong11/post/ed8d8e05-8067-4e1f-a0f8-a2727b1b374d/image.jpeg)

이처럼 beginWork()와 completeWork()에 의해 파이버 작업 순서가 결정된다.

setState가 발생하게 된다면, workInProgress 트리를 다시 빌드한다. 이미 만들어저 있으므로 기존 파이버만 업데이트 한다.

즉 가급적 객체를 생성하기 보다, 있는 파이버를 재사용하기 위해 내부 속성값만 초기화 하거나 바꾸는 형태로 트리를 업데이트 한다.

## 정리

- 가상 DOM 과 파이버는 단순히 브라우저 DOM을 직접 변경하기 하는 작업보다 빠르기 위해 만들어진 것이 아니다.
- DOM 변경을 효율적으로 하기 위해, 리액트 내부 파이버와 재조정자가 내부적인 알고리즘을 통해 관리함으로 대규모 웹 애플리케이션을 효율적으로 유지보수하고 관리할 수 있게 된 것이다.
- 가상 DOM을 UI로 표현하는 것이다. 자바스크립트의 문자열, 배열등으로 효율적으로 관리하기 위한 매커니즘이 리액트 핵십이다.
